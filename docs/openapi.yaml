openapi: 3.0.3
info:
  title: Evaluation Service API
  version: 1.2.0
  description: |
    Full API contract for the current backend implementation (Phases 1-5).
servers:
  - url: http://localhost:8080

tags:
  - name: Auth
  - name: Campaigns
  - name: Evaluations
  - name: Templates
  - name: Reports
  - name: Admin Settings
  - name: Audience
  - name: Rule Control Plane
  - name: Dashboard
  - name: Notifications

security:
  - bearerAuth: []

paths:
  /api/v1/auth/login:
    post:
      tags: [Auth]
      summary: Mock login (available only when dev-mode=true)
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: JWT token issued
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
        '401':
          description: Invalid credentials

  /api/v1/campaigns:
    post:
      tags: [Campaigns]
      summary: Create campaign
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateCampaignRequest'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CampaignResponse'
    get:
      tags: [Campaigns]
      summary: List campaigns
      parameters:
        - in: query
          name: status
          schema:
            type: string
        - in: query
          name: page
          schema:
            type: integer
            default: 0
        - in: query
          name: size
          schema:
            type: integer
      responses:
        '200':
          description: Campaign list
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/CampaignResponse'

  /api/v1/campaigns/{id}:
    get:
      tags: [Campaigns]
      summary: Get campaign by id
      parameters:
        - $ref: '#/components/parameters/IdPath'
      responses:
        '200':
          description: Campaign
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CampaignResponse'
    put:
      tags: [Campaigns]
      summary: Update campaign
      parameters:
        - $ref: '#/components/parameters/IdPath'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateCampaignRequest'
      responses:
        '200':
          description: Updated campaign
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CampaignResponse'

  /api/v1/campaigns/{id}/activate:
    post:
      tags: [Campaigns]
      summary: Activate campaign
      parameters:
        - $ref: '#/components/parameters/IdPath'
      responses:
        '200':
          description: Updated campaign
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CampaignResponse'

  /api/v1/campaigns/{id}/close:
    post:
      tags: [Campaigns]
      summary: Close campaign
      parameters:
        - $ref: '#/components/parameters/IdPath'
      responses:
        '200':
          description: Updated campaign
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CampaignResponse'

  /api/v1/campaigns/{id}/archive:
    post:
      tags: [Campaigns]
      summary: Archive campaign
      parameters:
        - $ref: '#/components/parameters/IdPath'
      responses:
        '200':
          description: Updated campaign
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CampaignResponse'

  /api/v1/campaigns/{id}/assignments:
    post:
      tags: [Campaigns]
      summary: Add assignments manually
      parameters:
        - $ref: '#/components/parameters/IdPath'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddAssignmentsRequest'
      responses:
        '200':
          description: Updated campaign
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CampaignResponse'

  /api/v1/campaigns/{id}/assignments/dynamic:
    post:
      tags: [Campaigns]
      summary: Generate dynamic assignments from source and rule config
      parameters:
        - $ref: '#/components/parameters/IdPath'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GenerateDynamicAssignmentsRequest'
      responses:
        '200':
          description: Generation result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DynamicAssignmentResponse'

  /api/v1/campaigns/{id}/extend-deadline:
    post:
      tags: [Campaigns]
      summary: Extend campaign deadline
      parameters:
        - $ref: '#/components/parameters/IdPath'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ExtendDeadlineRequest'
      responses:
        '200':
          description: Updated campaign
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CampaignResponse'

  /api/v1/campaigns/{id}/progress:
    get:
      tags: [Campaigns]
      summary: Campaign completion progress
      parameters:
        - $ref: '#/components/parameters/IdPath'
      responses:
        '200':
          description: Completion percentage
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProgressResponse'

  /api/v1/campaigns/{id}/lifecycle/publish:
    post:
      tags: [Campaigns]
      summary: Publish campaign in PDF lifecycle mode
      description: Admin-only endpoint. Enabled when `features.enable-pdf-lifecycle=true`.
      parameters:
        - $ref: '#/components/parameters/IdPath'
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LifecycleActionRequest'
            examples:
              withReason:
                value:
                  reason: Approved by committee
      responses:
        '200':
          description: Updated campaign
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CampaignResponse'
              examples:
                published:
                  value:
                    id: c-001
                    name: Spring 2026 Faculty Evaluation
                    description: Semester end evaluation cycle
                    templateId: t-001
                    templateVersion: 2
                    status: PUBLISHED_OPEN
                    startDate: '2026-03-01T00:00:00Z'
                    endDate: '2026-03-31T23:59:59Z'
                    scoringMethod: WEIGHTED_AVERAGE
                    anonymousMode: true
                    audienceSourceType: INLINE
                    audienceSourceConfig: {}
                    assignmentRuleType: ALL_TO_ALL
                    assignmentRuleConfig: {}
                    totalAssignments: 120
                    completedAssignments: 0
                    completionPercentage: 0
                    publishedAt: '2026-02-22T08:00:00Z'
                    reopenedAt: null
                    resultsPublishedAt: null
                    locked: true
                    createdBy: admin-user
                    createdAt: '2026-02-20T10:00:00Z'
                    updatedAt: '2026-02-22T08:00:00Z'

  /api/v1/campaigns/{id}/lifecycle/close:
    post:
      tags: [Campaigns]
      summary: Close campaign in PDF lifecycle mode
      description: Admin-only endpoint. Enabled when `features.enable-pdf-lifecycle=true`.
      parameters:
        - $ref: '#/components/parameters/IdPath'
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LifecycleActionRequest'
      responses:
        '200':
          description: Updated campaign
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CampaignResponse'

  /api/v1/campaigns/{id}/lifecycle/reopen:
    post:
      tags: [Campaigns]
      summary: Reopen closed campaign in PDF lifecycle mode
      description: Admin-only endpoint. Enabled when `features.enable-pdf-lifecycle=true`.
      parameters:
        - $ref: '#/components/parameters/IdPath'
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LifecycleActionRequest'
      responses:
        '200':
          description: Updated campaign
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CampaignResponse'

  /api/v1/campaigns/{id}/lifecycle/publish-results:
    post:
      tags: [Campaigns]
      summary: Publish results for campaign
      description: Admin-only endpoint. Enabled when `features.enable-pdf-lifecycle=true`.
      parameters:
        - $ref: '#/components/parameters/IdPath'
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LifecycleActionRequest'
      responses:
        '200':
          description: Updated campaign
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CampaignResponse'

  /api/v1/campaigns/{id}/lifecycle/impact-preview:
    post:
      tags: [Campaigns]
      summary: Preview lifecycle transition impact
      description: Admin-only endpoint. Enabled when `features.enable-pdf-lifecycle=true`.
      parameters:
        - $ref: '#/components/parameters/IdPath'
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LifecycleImpactPreviewRequest'
            examples:
              publishResults:
                value:
                  action: PUBLISH_RESULTS
      responses:
        '200':
          description: Lifecycle impact preview
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LifecycleImpactPreviewResponse'
              examples:
                preview:
                  value:
                    campaignId: c-001
                    action: PUBLISH_RESULTS
                    totalAssignments: 120
                    completedAssignments: 96
                    pendingAssignments: 24
                    summary: Results become visible to configured viewer roles.

  /api/v1/campaigns/{id}/lifecycle/events:
    get:
      tags: [Campaigns]
      summary: List recent lifecycle events for a campaign
      description: Admin-only endpoint. Enabled when `features.enable-pdf-lifecycle=true`.
      parameters:
        - $ref: '#/components/parameters/IdPath'
      responses:
        '200':
          description: Lifecycle event list
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/CampaignLifecycleEventResponse'
              examples:
                events:
                  value:
                    - id: 101
                      campaignId: c-001
                      fromStatus: CLOSED
                      toStatus: RESULTS_PUBLISHED
                      action: PUBLISH_RESULTS
                      actor: admin-user
                      reason: Board approved release
                      metadata:
                        campaignName: Spring 2026 Faculty Evaluation
                        completionPercentage: 80.0
                      createdAt: '2026-02-22T08:15:30Z'

  /api/v1/campaigns/{id}/steps:
    get:
      tags: [Campaigns]
      summary: List campaign steps and windows
      description: Admin-only endpoint. Enabled when `features.enable-step-windows=true`.
      parameters:
        - $ref: '#/components/parameters/IdPath'
      responses:
        '200':
          description: Campaign steps
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/CampaignStepResponse'
              examples:
                stepList:
                  value:
                    - id: 10
                      campaignId: c-001
                      stepType: STUDENT
                      enabled: true
                      displayOrder: 1
                      openAt: '2026-03-01T00:00:00Z'
                      closeAt: '2026-03-10T23:59:59Z'
                      lateAllowed: false
                      lateDays: 0
                      instructions: Complete student feedback first
                      notes: Window is strict
    put:
      tags: [Campaigns]
      summary: Replace campaign steps and windows
      description: Admin-only endpoint. Enabled when `features.enable-step-windows=true`.
      parameters:
        - $ref: '#/components/parameters/IdPath'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateCampaignStepsRequest'
            examples:
              replaceSteps:
                value:
                  steps:
                    - stepType: STUDENT
                      enabled: true
                      displayOrder: 1
                      openAt: '2026-03-01T00:00:00Z'
                      closeAt: '2026-03-10T23:59:59Z'
                      lateAllowed: false
                      lateDays: 0
                      instructions: Complete student feedback first
                      notes: Window is strict
                    - stepType: PEER
                      enabled: true
                      displayOrder: 2
                      openAt: '2026-03-11T00:00:00Z'
                      closeAt: '2026-03-20T23:59:59Z'
                      lateAllowed: true
                      lateDays: 2
                      instructions: Peer review period
                      notes: null
      responses:
        '200':
          description: Updated campaign steps
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/CampaignStepResponse'
              examples:
                updated:
                  value:
                    - id: 10
                      campaignId: c-001
                      stepType: STUDENT
                      enabled: true
                      displayOrder: 1
                      openAt: '2026-03-01T00:00:00Z'
                      closeAt: '2026-03-10T23:59:59Z'
                      lateAllowed: false
                      lateDays: 0
                      instructions: Complete student feedback first
                      notes: Window is strict

  /api/v1/campaigns/assignments/me:
    get:
      tags: [Campaigns]
      summary: Current evaluator assignments
      responses:
        '200':
          description: Assignment list
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/MyAssignmentResponse'

  /api/v1/campaigns/{id}/assignments/reconcile:
    get:
      tags: [Campaigns]
      summary: Reconcile campaign assignment parity (legacy JSON vs relational)
      parameters:
        - $ref: '#/components/parameters/IdPath'
      responses:
        '200':
          description: Reconciliation report
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AssignmentReconciliationResponse'

  /api/v1/campaigns/assignments/reconcile/report:
    get:
      tags: [Campaigns]
      summary: Aggregate assignment parity report
      parameters:
        - in: query
          name: maxCampaigns
          schema:
            type: integer
            default: 1000
      responses:
        '200':
          description: Parity report
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AssignmentParityReportResponse'

  /api/v1/campaigns/assignments/backfill:
    post:
      tags: [Campaigns]
      summary: Backfill relational assignments from legacy campaign JSON
      parameters:
        - in: query
          name: dryRun
          schema:
            type: boolean
            default: true
        - in: query
          name: maxCampaigns
          schema:
            type: integer
            default: 1000
      responses:
        '200':
          description: Backfill report
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AssignmentBackfillResponse'

  /api/v1/assignments:
    get:
      tags: [Campaigns]
      summary: List rich assignments (admin)
      parameters:
        - in: query
          name: campaignId
          schema: { type: string }
        - in: query
          name: stepType
          schema: { type: string }
        - in: query
          name: sectionId
          schema: { type: string }
        - in: query
          name: facultyId
          schema: { type: string }
        - in: query
          name: status
          schema: { type: string }
        - in: query
          name: evaluatorId
          schema: { type: string }
        - in: query
          name: evaluateeId
          schema: { type: string }
        - in: query
          name: page
          schema: { type: integer, default: 0 }
        - in: query
          name: size
          schema: { type: integer, default: 20 }
        - in: query
          name: sortBy
          schema: { type: string, default: updatedAt }
        - in: query
          name: sortDir
          schema: { type: string, default: desc }
      responses:
        '200':
          description: Assignment list
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AssignmentListResponse'
    post:
      tags: [Campaigns]
      summary: Create rich assignment (admin)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateAssignmentRequest'
      responses:
        '201':
          description: Assignment created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AssignmentResponse'
        '409':
          description: Duplicate assignment tuple conflict
          content:
            application/json:
              schema:
                type: object
              examples:
                duplicateAssignment:
                  value:
                    type: https://api.evaluationservice.com/errors/duplicate-assignment
                    title: Duplicate Assignment
                    status: 409
                    detail: Duplicate assignment tuple for campaign/evaluator/evaluatee/role
                    campaignId: c-001
                    evaluatorId: e-100
                    evaluateeId: u-200
                    evaluatorRole: PEER
                    existingAssignmentId: a-existing

  /api/v1/assignments/{id}:
    get:
      tags: [Campaigns]
      summary: Get assignment by id (admin)
      parameters:
        - $ref: '#/components/parameters/IdPath'
      responses:
        '200':
          description: Assignment
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AssignmentResponse'
    put:
      tags: [Campaigns]
      summary: Update assignment metadata (admin)
      parameters:
        - $ref: '#/components/parameters/IdPath'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateAssignmentRequest'
      responses:
        '200':
          description: Assignment updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AssignmentResponse'

  /api/v1/evaluators/me/dashboard:
    get:
      tags: [Campaigns]
      summary: Evaluator dashboard aggregate
      responses:
        '200':
          description: Evaluator dashboard summary
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EvaluatorDashboardResponse'

  /api/v1/questions-bank/sets:
    post:
      tags: [Templates]
      summary: Create question bank set (admin)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateQuestionBankSetRequest'
      responses:
        '201':
          description: Created question bank set
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/QuestionBankSetResponse'
    get:
      tags: [Templates]
      summary: List question bank sets (admin)
      parameters:
        - in: query
          name: tenantId
          schema: { type: string }
        - in: query
          name: status
          schema: { type: string }
      responses:
        '200':
          description: Question bank sets
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/QuestionBankSetResponse'

  /api/v1/questions-bank/sets/{setId}/items:
    post:
      tags: [Templates]
      summary: Create question bank item (admin)
      parameters:
        - in: path
          name: setId
          required: true
          schema: { type: integer, format: int64 }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateQuestionBankItemRequest'
      responses:
        '201':
          description: Created question bank item
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/QuestionBankItemResponse'
    get:
      tags: [Templates]
      summary: List question bank items in a set (admin)
      parameters:
        - in: path
          name: setId
          required: true
          schema: { type: integer, format: int64 }
        - in: query
          name: status
          schema: { type: string }
      responses:
        '200':
          description: Question bank items
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/QuestionBankItemResponse'

  /api/v1/questions-bank/items/{itemId}/versions:
    post:
      tags: [Templates]
      summary: Create question item version (admin)
      parameters:
        - in: path
          name: itemId
          required: true
          schema: { type: integer, format: int64 }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateQuestionBankItemVersionRequest'
      responses:
        '201':
          description: Created question item version
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/QuestionBankItemVersionResponse'
    get:
      tags: [Templates]
      summary: List question item versions (admin)
      parameters:
        - in: path
          name: itemId
          required: true
          schema: { type: integer, format: int64 }
        - in: query
          name: status
          schema: { type: string }
      responses:
        '200':
          description: Question item versions
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/QuestionBankItemVersionResponse'

  /api/v1/questions-bank/items/{itemId}/versions/{versionNo}/activate:
    post:
      tags: [Templates]
      summary: Activate question item version (admin)
      parameters:
        - in: path
          name: itemId
          required: true
          schema: { type: integer, format: int64 }
        - in: path
          name: versionNo
          required: true
          schema: { type: integer }
      responses:
        '200':
          description: Activated question item version
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/QuestionBankItemVersionResponse'

  /api/v1/questions-bank/items/{itemId}/versions/compare:
    get:
      tags: [Templates]
      summary: Compare two question item versions (admin)
      parameters:
        - in: path
          name: itemId
          required: true
          schema: { type: integer, format: int64 }
        - in: query
          name: fromVersion
          required: true
          schema: { type: integer }
        - in: query
          name: toVersion
          required: true
          schema: { type: integer }
      responses:
        '200':
          description: Version comparison
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/QuestionVersionCompareResponse'

  /api/v1/scoring/preview:
    post:
      tags: [Reports]
      summary: Preview scoring for sample answers (admin)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ScoringPreviewRequest'
      responses:
        '200':
          description: Scoring preview
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ScoringPreviewResponse'

  /api/v1/admin/notifications/rules:
    post:
      tags: [Notifications]
      summary: Create notification rule (admin)
      description: Enabled only when `features.enable-notification-rule-engine=true`.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateNotificationRuleRequest'
      responses:
        '201':
          description: Created rule
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotificationRuleResponse'
    get:
      tags: [Notifications]
      summary: List notification rules (admin)
      description: Enabled only when `features.enable-notification-rule-engine=true`.
      parameters:
        - in: query
          name: campaignId
          required: false
          schema:
            type: string
      responses:
        '200':
          description: Rule list
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/NotificationRuleResponse'

  /api/v1/admin/notifications/rules/{id}:
    get:
      tags: [Notifications]
      summary: Get notification rule by id (admin)
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: Rule
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotificationRuleResponse'
    put:
      tags: [Notifications]
      summary: Update notification rule (admin)
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateNotificationRuleRequest'
      responses:
        '200':
          description: Updated rule
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotificationRuleResponse'
    delete:
      tags: [Notifications]
      summary: Delete notification rule (admin)
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '204':
          description: Deleted

  /api/v1/admin/notifications/templates:
    post:
      tags: [Notifications]
      summary: Create notification template (admin)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateNotificationTemplateRequest'
      responses:
        '201':
          description: Created template
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotificationTemplateResponse'
    get:
      tags: [Notifications]
      summary: List notification templates (admin)
      parameters:
        - in: query
          name: campaignId
          required: false
          schema:
            type: string
      responses:
        '200':
          description: Template list
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/NotificationTemplateResponse'

  /api/v1/admin/notifications/templates/{id}:
    get:
      tags: [Notifications]
      summary: Get notification template by id (admin)
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: Template
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotificationTemplateResponse'
    put:
      tags: [Notifications]
      summary: Update notification template (admin)
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateNotificationTemplateRequest'
      responses:
        '200':
          description: Updated template
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotificationTemplateResponse'
    delete:
      tags: [Notifications]
      summary: Delete notification template (admin)
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '204':
          description: Deleted

  /api/v1/admin/notifications/templates/{id}/test-render:
    post:
      tags: [Notifications]
      summary: Render notification template body with variables (admin)
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TestNotificationTemplateRequest'
      responses:
        '200':
          description: Rendered template body
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TemplateRenderResponse'

  /api/v1/admin/notifications/deliveries:
    get:
      tags: [Notifications]
      summary: List notification deliveries (admin)
      parameters:
        - in: query
          name: campaignId
          schema:
            type: string
        - in: query
          name: ruleId
          schema:
            type: integer
            format: int64
        - in: query
          name: status
          schema:
            type: string
      responses:
        '200':
          description: Delivery list
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/NotificationDeliveryResponse'

  /api/v1/admin/notifications/deliveries/{id}/retry:
    post:
      tags: [Notifications]
      summary: Retry failed notification delivery (admin)
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: Delivery after retry attempt
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotificationDeliveryResponse'

  /api/v1/evaluations:
    post:
      tags: [Evaluations]
      summary: Submit evaluation
      description: |
        Submits and scores an evaluation. When `features.enable-step-windows=true`,
        the assignment's step window policy is enforced (enabled step, open/close window,
        optional late window).
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SubmitEvaluationRequest'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EvaluationResponse'

  /api/v1/evaluations/validate-submit:
    post:
      tags: [Evaluations]
      summary: Validate submission payload before submit
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SubmitEvaluationRequest'
      responses:
        '200':
          description: Validation result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SubmissionValidationResponse'

  /api/v1/evaluations/{id}:
    get:
      tags: [Evaluations]
      summary: Get evaluation
      parameters:
        - $ref: '#/components/parameters/IdPath'
      responses:
        '200':
          description: Evaluation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EvaluationResponse'
    put:
      tags: [Evaluations]
      summary: Save/update evaluation draft
      parameters:
        - $ref: '#/components/parameters/IdPath'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateEvaluationRequest'
      responses:
        '200':
          description: Updated evaluation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EvaluationResponse'

  /api/v1/evaluations/{id}/receipt:
    get:
      tags: [Evaluations]
      summary: Get submission receipt by evaluation id
      parameters:
        - $ref: '#/components/parameters/IdPath'
      responses:
        '200':
          description: Submission receipt
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SubmissionReceiptResponse'

  /api/v1/evaluations/{id}/admin-detail:
    get:
      tags: [Evaluations]
      summary: Admin submission detail projection
      parameters:
        - $ref: '#/components/parameters/IdPath'
      responses:
        '200':
          description: Admin submission detail
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AdminSubmissionDetailResponse'

  /api/v1/evaluations/campaign/{campaignId}:
    get:
      tags: [Evaluations]
      summary: List evaluations by campaign
      parameters:
        - in: path
          name: campaignId
          required: true
          schema:
            type: string
        - in: query
          name: page
          schema:
            type: integer
            default: 0
        - in: query
          name: size
          schema:
            type: integer
      responses:
        '200':
          description: Evaluation list
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/EvaluationResponse'

  /api/v1/evaluations/evaluatee/{evaluateeId}:
    get:
      tags: [Evaluations]
      summary: List evaluations by evaluatee
      parameters:
        - in: path
          name: evaluateeId
          required: true
          schema:
            type: string
        - in: query
          name: page
          schema:
            type: integer
            default: 0
        - in: query
          name: size
          schema:
            type: integer
      responses:
        '200':
          description: Evaluation list
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/EvaluationResponse'

  /api/v1/evaluations/{id}/flag:
    post:
      tags: [Evaluations]
      summary: Flag evaluation
      parameters:
        - $ref: '#/components/parameters/IdPath'
      responses:
        '200':
          description: Flagged

  /api/v1/evaluations/{id}/invalidate:
    post:
      tags: [Evaluations]
      summary: Invalidate evaluation
      parameters:
        - $ref: '#/components/parameters/IdPath'
      responses:
        '200':
          description: Invalidated

  /api/v1/evaluations/{id}/reopen:
    post:
      tags: [Evaluations]
      summary: Reopen evaluation for revision (admin)
      parameters:
        - $ref: '#/components/parameters/IdPath'
      responses:
        '200':
          description: Reopened

  /api/v1/templates:
    post:
      tags: [Templates]
      summary: Create template
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateTemplateRequest'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TemplateResponse'
    get:
      tags: [Templates]
      summary: List templates
      parameters:
        - in: query
          name: category
          schema:
            type: string
        - in: query
          name: page
          schema:
            type: integer
            default: 0
        - in: query
          name: size
          schema:
            type: integer
      responses:
        '200':
          description: Template list
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/TemplateResponse'

  /api/v1/templates/{id}:
    get:
      tags: [Templates]
      summary: Get template
      parameters:
        - $ref: '#/components/parameters/IdPath'
      responses:
        '200':
          description: Template
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TemplateResponse'
    put:
      tags: [Templates]
      summary: Update template
      parameters:
        - $ref: '#/components/parameters/IdPath'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateTemplateRequest'
      responses:
        '200':
          description: Updated template
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TemplateResponse'
    delete:
      tags: [Templates]
      summary: Delete template
      parameters:
        - $ref: '#/components/parameters/IdPath'
      responses:
        '204':
          description: Deleted

  /api/v1/templates/{id}/publish:
    post:
      tags: [Templates]
      summary: Publish template
      parameters:
        - $ref: '#/components/parameters/IdPath'
      responses:
        '200':
          description: Template
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TemplateResponse'

  /api/v1/templates/{id}/deprecate:
    post:
      tags: [Templates]
      summary: Deprecate template
      parameters:
        - $ref: '#/components/parameters/IdPath'
      responses:
        '200':
          description: Template
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TemplateResponse'

  /api/v1/reports/individual:
    get:
      tags: [Reports]
      summary: Individual report
      parameters:
        - in: query
          name: evaluateeId
          required: true
          schema:
            type: string
        - in: query
          name: campaignId
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Individual report
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/IndividualReportResult'
        '403':
          description: Reports are disabled by feature flag

  /api/v1/reports/campaign/{campaignId}:
    get:
      tags: [Reports]
      summary: Campaign report
      parameters:
        - in: path
          name: campaignId
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Campaign report
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CampaignReportResult'
        '403':
          description: Reports are disabled by feature flag

  /api/v1/reports/export/csv/{campaignId}:
    get:
      tags: [Reports]
      summary: Export campaign report CSV
      parameters:
        - in: path
          name: campaignId
          required: true
          schema:
            type: string
      responses:
        '200':
          description: CSV bytes
          content:
            text/csv:
              schema:
                type: string
                format: binary
        '403':
          description: CSV export is disabled by feature flag

  /api/v1/reports/export/pdf:
    get:
      tags: [Reports]
      summary: Export individual report PDF
      parameters:
        - in: query
          name: evaluateeId
          required: true
          schema:
            type: string
        - in: query
          name: campaignId
          required: true
          schema:
            type: string
      responses:
        '200':
          description: PDF bytes
          content:
            application/pdf:
              schema:
                type: string
                format: binary
        '403':
          description: PDF export is disabled by feature flag

  /api/v1/admin/settings:
    get:
      tags: [Admin Settings]
      summary: List system settings
      responses:
        '200':
          description: Settings list
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/SettingResponse'

  /api/v1/admin/settings/category/{category}:
    get:
      tags: [Admin Settings]
      summary: List settings by category
      parameters:
        - in: path
          name: category
          required: true
          schema:
            type: string
            enum: [SCORING, CAMPAIGN, NOTIFICATION, FEATURES, PAGINATION]
      responses:
        '200':
          description: Settings list
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/SettingResponse'

  /api/v1/admin/settings/{key}:
    get:
      tags: [Admin Settings]
      summary: Get setting by key
      parameters:
        - in: path
          name: key
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Setting
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SettingResponse'
    put:
      tags: [Admin Settings]
      summary: Update setting by key
      parameters:
        - in: path
          name: key
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ValuePayload'
      responses:
        '200':
          description: Updated setting
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SettingResponse'
        '400':
          description: Missing value in body

  /api/v1/admin/settings/campaigns/{campaignId}:
    get:
      tags: [Admin Settings]
      summary: List campaign-level overrides
      parameters:
        - in: path
          name: campaignId
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Overrides
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/OverrideResponse'

  /api/v1/admin/settings/campaigns/{campaignId}/{key}:
    put:
      tags: [Admin Settings]
      summary: Set campaign-level override
      parameters:
        - in: path
          name: campaignId
          required: true
          schema:
            type: string
        - in: path
          name: key
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ValuePayload'
      responses:
        '200':
          description: Override saved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OverrideResponse'
        '400':
          description: Missing value in body
    delete:
      tags: [Admin Settings]
      summary: Remove campaign-level override
      parameters:
        - in: path
          name: campaignId
          required: true
          schema:
            type: string
        - in: path
          name: key
          required: true
          schema:
            type: string
      responses:
        '204':
          description: Deleted

  /api/v1/audience/ingest:
    post:
      tags: [Audience]
      summary: Ingest audience data from connector
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/IngestAudienceRequest'
      responses:
        '200':
          description: Ingestion run result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AudienceIngestionResponse'

  /api/v1/audience/ingestion-runs:
    get:
      tags: [Audience]
      summary: List ingestion runs
      parameters:
        - in: query
          name: tenantId
          schema:
            type: string
        - in: query
          name: limit
          schema:
            type: integer
            default: 50
      responses:
        '200':
          description: Ingestion runs
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/AudienceIngestionRunResponse'

  /api/v1/audience/ingestion-runs/{runId}:
    get:
      tags: [Audience]
      summary: Get ingestion run
      parameters:
        - in: path
          name: runId
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Ingestion run details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AudienceIngestionRunResponse'

  /api/v1/audience/ingestion-runs/{runId}/rejections:
    get:
      tags: [Audience]
      summary: List row-level rejections for ingestion run
      parameters:
        - in: path
          name: runId
          required: true
          schema:
            type: string
        - in: query
          name: limit
          schema:
            type: integer
            default: 200
      responses:
        '200':
          description: Rejection rows
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/AudienceIngestionRejectionResponse'

  /api/v1/audience/ingestion-runs/{runId}/replay:
    post:
      tags: [Audience]
      summary: Replay ingestion using stored snapshot
      parameters:
        - in: path
          name: runId
          required: true
          schema:
            type: string
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ReplayAudienceIngestionRequest'
      responses:
        '200':
          description: Replay run result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AudienceIngestionResponse'

  /api/v1/audience/mapping-profiles:
    post:
      tags: [Audience]
      summary: Create mapping profile
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateAudienceMappingProfileRequest'
      responses:
        '200':
          description: Created profile
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AudienceMappingProfileResponse'
    get:
      tags: [Audience]
      summary: List mapping profiles by tenant
      parameters:
        - in: query
          name: tenantId
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Mapping profiles
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/AudienceMappingProfileResponse'

  /api/v1/audience/mapping-profiles/{profileId}:
    put:
      tags: [Audience]
      summary: Update mapping profile
      parameters:
        - in: path
          name: profileId
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateAudienceMappingProfileRequest'
      responses:
        '200':
          description: Updated profile
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AudienceMappingProfileResponse'
    get:
      tags: [Audience]
      summary: Get mapping profile
      parameters:
        - in: path
          name: profileId
          required: true
          schema:
            type: integer
            format: int64
        - in: query
          name: tenantId
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Mapping profile
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AudienceMappingProfileResponse'

  /api/v1/audience/mapping-profiles/{profileId}/deactivate:
    post:
      tags: [Audience]
      summary: Deactivate mapping profile
      parameters:
        - in: path
          name: profileId
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DeactivateAudienceMappingProfileRequest'
      responses:
        '200':
          description: Deactivated profile
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AudienceMappingProfileResponse'

  /api/v1/audience/mapping-profiles/{profileId}/events:
    get:
      tags: [Audience]
      summary: List mapping profile lifecycle events
      parameters:
        - in: path
          name: profileId
          required: true
          schema:
            type: integer
            format: int64
        - in: query
          name: tenantId
          required: true
          schema:
            type: string
        - in: query
          name: limit
          schema:
            type: integer
            default: 50
      responses:
        '200':
          description: Lifecycle events
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/AudienceMappingProfileEventResponse'

  /api/v1/audience/mapping-profiles/validate:
    post:
      tags: [Audience]
      summary: Validate and normalize mapping profile payload
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ValidateAudienceMappingProfileRequest'
      responses:
        '200':
          description: Validation result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AudienceMappingValidationResponse'

  /api/v1/admin/rules:
    post:
      tags: [Rule Control Plane]
      summary: Create draft rule definition
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateRuleDefinitionRequest'
      responses:
        '200':
          description: Created draft
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RuleDefinitionResponse'
    get:
      tags: [Rule Control Plane]
      summary: List rule definitions
      parameters:
        - in: query
          name: tenantId
          required: true
          schema:
            type: string
        - in: query
          name: status
          schema:
            type: string
      responses:
        '200':
          description: Rule definitions
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/RuleDefinitionResponse'

  /api/v1/admin/rules/{id}:
    put:
      tags: [Rule Control Plane]
      summary: Update draft rule definition
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateRuleDefinitionRequest'
      responses:
        '200':
          description: Updated rule
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RuleDefinitionResponse'
    get:
      tags: [Rule Control Plane]
      summary: Get rule definition
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
            format: int64
        - in: query
          name: tenantId
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Rule definition
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RuleDefinitionResponse'

  /api/v1/admin/rules/{id}/publish-requests:
    post:
      tags: [Rule Control Plane]
      summary: Create publish approval request for rule
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateRulePublishRequest'
      responses:
        '200':
          description: Publish request created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RulePublishRequestResponse'

  /api/v1/admin/rules/publish-requests/{publishRequestId}/approve:
    post:
      tags: [Rule Control Plane]
      summary: Approve publish request
      parameters:
        - in: path
          name: publishRequestId
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DecideRulePublishRequest'
      responses:
        '200':
          description: Publish request approved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RulePublishRequestResponse'

  /api/v1/admin/rules/publish-requests/{publishRequestId}/reject:
    post:
      tags: [Rule Control Plane]
      summary: Reject publish request
      parameters:
        - in: path
          name: publishRequestId
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DecideRulePublishRequest'
      responses:
        '200':
          description: Publish request rejected
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RulePublishRequestResponse'

  /api/v1/admin/rules/{id}/deprecate:
    post:
      tags: [Rule Control Plane]
      summary: Deprecate rule definition
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DecideRulePublishRequest'
      responses:
        '200':
          description: Deprecated rule
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RuleDefinitionResponse'

  /api/v1/admin/rules/{id}/simulate:
    post:
      tags: [Rule Control Plane]
      summary: Simulate rule against audience source
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SimulateRuleRequest'
      responses:
        '200':
          description: Simulation result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RuleSimulationResponse'

  /api/v1/admin/rules/{id}/publish-assignments:
    post:
      tags: [Rule Control Plane]
      summary: Generate and publish assignments to campaign using rule definition
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PublishRuleAssignmentsRequest'
      responses:
        '200':
          description: Assignment generation result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DynamicAssignmentResponse'

  /api/v1/admin/rules/capabilities:
    get:
      tags: [Rule Control Plane]
      summary: Get supported rule/audience types and workflow guardrail settings
      responses:
        '200':
          description: Capability payload
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RuleControlPlaneCapabilitiesResponse'

  /api/v1/dashboard/stats:
    get:
      tags: [Dashboard]
      summary: Dashboard summary stats
      responses:
        '200':
          description: Dashboard stats
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DashboardStatsResponse'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  parameters:
    IdPath:
      in: path
      name: id
      required: true
      schema:
        type: string

  schemas:
    AnyObject:
      type: object
      additionalProperties: true

    ValuePayload:
      type: object
      required: [value]
      properties:
        value:
          type: string

    LoginRequest:
      type: object
      required: [username, password]
      properties:
        username:
          type: string
        password:
          type: string

    LoginResponse:
      type: object
      properties:
        token:
          type: string

    CreateCampaignRequest:
      type: object
      required: [name, templateId, startDate, endDate]
      properties:
        name: { type: string }
        description: { type: string }
        templateId: { type: string }
        templateVersion: { type: integer }
        startDate: { type: string, format: date-time }
        endDate: { type: string, format: date-time }
        scoringMethod:
          type: string
          enum: [WEIGHTED_AVERAGE, SIMPLE_AVERAGE, MEDIAN, PERCENTILE_RANK, CUSTOM_FORMULA]
        anonymousMode: { type: boolean }
        anonymousRoles:
          type: array
          items:
            type: string
            enum: [SELF, PEER, SUPERVISOR, SUBORDINATE, EXTERNAL]
        audienceSourceType: { type: string }
        audienceSourceConfig:
          $ref: '#/components/schemas/AnyObject'
        assignmentRuleType: { type: string }
        assignmentRuleConfig:
          $ref: '#/components/schemas/AnyObject'
        minimumRespondents: { type: integer }

    UpdateCampaignRequest:
      type: object
      required: [name, startDate, endDate]
      properties:
        name: { type: string }
        description: { type: string }
        startDate: { type: string, format: date-time }
        endDate: { type: string, format: date-time }
        scoringMethod:
          type: string
          enum: [WEIGHTED_AVERAGE, SIMPLE_AVERAGE, MEDIAN, PERCENTILE_RANK, CUSTOM_FORMULA]
        anonymousMode: { type: boolean }
        anonymousRoles:
          type: array
          items:
            type: string
            enum: [SELF, PEER, SUPERVISOR, SUBORDINATE, EXTERNAL]
        audienceSourceType: { type: string }
        audienceSourceConfig:
          $ref: '#/components/schemas/AnyObject'
        assignmentRuleType: { type: string }
        assignmentRuleConfig:
          $ref: '#/components/schemas/AnyObject'
        minimumRespondents: { type: integer }

    AddAssignmentsRequest:
      type: object
      required: [assignments]
      properties:
        assignments:
          type: array
          items:
            $ref: '#/components/schemas/AssignmentEntry'

    AssignmentEntry:
      type: object
      required: [evaluatorId, evaluateeId, evaluatorRole]
      properties:
        evaluatorId: { type: string }
        evaluateeId: { type: string }
        evaluatorRole:
          type: string
          enum: [SELF, PEER, SUPERVISOR, SUBORDINATE, EXTERNAL]

    GenerateDynamicAssignmentsRequest:
      type: object
      required: [audienceSourceType, audienceSourceConfig, assignmentRuleType, assignmentRuleConfig]
      properties:
        audienceSourceType:
          type: string
          enum: [INLINE, DIRECTORY_SNAPSHOT]
        audienceSourceConfig:
          $ref: '#/components/schemas/AnyObject'
        assignmentRuleType:
          type: string
          enum: [ALL_TO_ALL, ROUND_ROBIN, MANAGER_HIERARCHY, ATTRIBUTE_MATCH]
        assignmentRuleConfig:
          $ref: '#/components/schemas/AnyObject'
        replaceExistingAssignments: { type: boolean }
        dryRun: { type: boolean }

    DynamicAssignmentResponse:
      type: object
      properties:
        campaignId: { type: string }
        audienceSourceType: { type: string }
        assignmentRuleType: { type: string }
        replaceExistingAssignments: { type: boolean }
        dryRun: { type: boolean }
        generatedCount: { type: integer }
        assignments:
          type: array
          items:
            $ref: '#/components/schemas/DynamicAssignmentItem'

    DynamicAssignmentItem:
      type: object
      properties:
        assignmentId: { type: string }
        evaluatorId: { type: string }
        evaluateeId: { type: string }
        evaluatorRole:
          type: string
          enum: [SELF, PEER, SUPERVISOR, SUBORDINATE, EXTERNAL]

    ExtendDeadlineRequest:
      type: object
      required: [newEndDate]
      properties:
        newEndDate:
          type: string
          format: date-time

    ProgressResponse:
      type: object
      properties:
        completionPercentage:
          type: number
          format: double

    LifecycleImpactPreviewRequest:
      type: object
      properties:
        action: { type: string }

    LifecycleActionRequest:
      type: object
      properties:
        reason: { type: string, nullable: true }

    LifecycleImpactPreviewResponse:
      type: object
      properties:
        campaignId: { type: string }
        action: { type: string }
        totalAssignments: { type: integer, format: int64 }
        completedAssignments: { type: integer, format: int64 }
        pendingAssignments: { type: integer, format: int64 }
        summary: { type: string }

    UpdateCampaignStepsRequest:
      type: object
      required: [steps]
      properties:
        steps:
          type: array
          items:
            $ref: '#/components/schemas/CampaignStepUpsertItem'

    CreateAssignmentRequest:
      type: object
      required: [campaignId, evaluatorId, evaluateeId, evaluatorRole]
      properties:
        campaignId: { type: string }
        evaluatorId: { type: string }
        evaluateeId: { type: string }
        evaluatorRole: { type: string }
        stepType: { type: string, nullable: true }
        sectionId: { type: string, nullable: true }
        facultyId: { type: string, nullable: true }
        anonymityMode: { type: string, nullable: true }
        status: { type: string, nullable: true }

    UpdateAssignmentRequest:
      type: object
      properties:
        stepType: { type: string, nullable: true }
        sectionId: { type: string, nullable: true }
        facultyId: { type: string, nullable: true }
        anonymityMode: { type: string, nullable: true }
        status: { type: string, nullable: true }

    CampaignStepUpsertItem:
      type: object
      properties:
        stepType: { type: string }
        enabled: { type: boolean }
        displayOrder: { type: integer }
        openAt: { type: string, format: date-time, nullable: true }
        closeAt: { type: string, format: date-time, nullable: true }
        lateAllowed: { type: boolean }
        lateDays: { type: integer }
        instructions: { type: string, nullable: true }
        notes: { type: string, nullable: true }

    CampaignStepResponse:
      type: object
      properties:
        id: { type: integer, format: int64 }
        campaignId: { type: string }
        stepType: { type: string }
        enabled: { type: boolean }
        displayOrder: { type: integer }
        openAt: { type: string, format: date-time, nullable: true }
        closeAt: { type: string, format: date-time, nullable: true }
        lateAllowed: { type: boolean }
        lateDays: { type: integer }
        instructions: { type: string, nullable: true }
        notes: { type: string, nullable: true }

    CampaignLifecycleEventResponse:
      type: object
      properties:
        id: { type: integer, format: int64 }
        campaignId: { type: string }
        fromStatus: { type: string, nullable: true }
        toStatus: { type: string }
        action: { type: string }
        actor: { type: string }
        reason: { type: string, nullable: true }
        metadata:
          $ref: '#/components/schemas/AnyObject'
        createdAt: { type: string, format: date-time }

    CampaignResponse:
      type: object
      properties:
        id: { type: string }
        name: { type: string }
        description: { type: string }
        templateId: { type: string }
        templateVersion: { type: integer }
        status:
          type: string
          enum: [DRAFT, SCHEDULED, ACTIVE, PUBLISHED_OPEN, CLOSED, RESULTS_PUBLISHED, ARCHIVED]
        startDate: { type: string, format: date-time }
        endDate: { type: string, format: date-time }
        scoringMethod:
          type: string
          enum: [WEIGHTED_AVERAGE, SIMPLE_AVERAGE, MEDIAN, PERCENTILE_RANK, CUSTOM_FORMULA]
        anonymousMode: { type: boolean }
        audienceSourceType: { type: string }
        audienceSourceConfig:
          $ref: '#/components/schemas/AnyObject'
        assignmentRuleType: { type: string }
        assignmentRuleConfig:
          $ref: '#/components/schemas/AnyObject'
        totalAssignments: { type: integer }
        completedAssignments: { type: integer, format: int64 }
        completionPercentage: { type: number, format: double }
        publishedAt: { type: string, format: date-time, nullable: true }
        reopenedAt: { type: string, format: date-time, nullable: true }
        resultsPublishedAt: { type: string, format: date-time, nullable: true }
        locked: { type: boolean }
        createdBy: { type: string }
        createdAt: { type: string, format: date-time }
        updatedAt: { type: string, format: date-time }

    SubmitEvaluationRequest:
      type: object
      required: [campaignId, assignmentId, evaluatorId, evaluateeId, templateId, answers]
      properties:
        campaignId: { type: string }
        assignmentId: { type: string }
        evaluatorId: { type: string }
        evaluateeId: { type: string }
        templateId: { type: string }
        answers:
          type: array
          items:
            $ref: '#/components/schemas/AnswerRequest'

    UpdateEvaluationRequest:
      type: object
      properties:
        answers:
          type: array
          items:
            $ref: '#/components/schemas/AnswerRequest'

    AnswerRequest:
      type: object
      properties:
        questionId: { type: string }
        value: {}
        selectedOptions:
          type: array
          items: { type: string }
        textResponse: { type: string }
        metadata:
          $ref: '#/components/schemas/AnyObject'

    EvaluationResponse:
      type: object
      properties:
        id: { type: string }
        campaignId: { type: string }
        assignmentId: { type: string }
        evaluatorId: { type: string }
        evaluateeId: { type: string }
        templateId: { type: string }
        answers:
          type: array
          items:
            $ref: '#/components/schemas/AnswerResponse'
        status:
          type: string
          enum: [DRAFT, SUBMITTED, SCORING, COMPLETED, FLAGGED, INVALIDATED]
        totalScore: { type: number, format: double, nullable: true }
        answerCount: { type: integer }
        createdAt: { type: string, format: date-time }
        submittedAt: { type: string, format: date-time, nullable: true }

    SubmissionValidationResponse:
      type: object
      properties:
        valid: { type: boolean }
        issueCount: { type: integer }
        issues:
          type: array
          items:
            $ref: '#/components/schemas/SubmissionValidationIssue'

    SubmissionValidationIssue:
      type: object
      properties:
        questionId: { type: string, nullable: true }
        code: { type: string }
        message: { type: string }

    SubmissionReceiptResponse:
      type: object
      properties:
        evaluationId: { type: string }
        campaignId: { type: string }
        assignmentId: { type: string }
        evaluatorId: { type: string }
        evaluateeId: { type: string }
        status:
          type: string
          enum: [DRAFT, SUBMITTED, SCORING, COMPLETED, FLAGGED, INVALIDATED]
        submittedAt: { type: string, format: date-time, nullable: true }
        totalScore: { type: number, format: double, nullable: true }

    AnswerResponse:
      type: object
      properties:
        id: { type: string }
        questionId: { type: string }
        value: { type: string }
        selectedOptions:
          type: array
          items: { type: string }
        textResponse: { type: string }
        metadata:
          $ref: '#/components/schemas/AnyObject'

    MyAssignmentResponse:
      type: object
      properties:
        id: { type: string }
        campaignId: { type: string }
        campaignName: { type: string }
        endDate: { type: string, format: date-time }
        evaluateeId: { type: string }
        status: { type: string }
        evaluationId: { type: string, nullable: true }

    AssignmentResponse:
      type: object
      properties:
        id: { type: string }
        campaignId: { type: string }
        evaluatorId: { type: string }
        evaluateeId: { type: string }
        evaluatorRole: { type: string }
        completed: { type: boolean }
        evaluationId: { type: string, nullable: true }
        stepType: { type: string, nullable: true }
        sectionId: { type: string, nullable: true }
        facultyId: { type: string, nullable: true }
        anonymityMode: { type: string, nullable: true }
        status: { type: string }
        createdAt: { type: string, format: date-time }
        updatedAt: { type: string, format: date-time }

    AssignmentListResponse:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/AssignmentResponse'
        page: { type: integer }
        size: { type: integer }
        totalItems: { type: integer, format: int64 }
        totalPages: { type: integer }

    EvaluatorDashboardResponse:
      type: object
      properties:
        evaluatorId: { type: string }
        assignedCount: { type: integer, format: int64 }
        completedCount: { type: integer, format: int64 }
        pendingCount: { type: integer, format: int64 }
        draftCount: { type: integer, format: int64 }
        submittedCount: { type: integer, format: int64 }
        completionPercentage: { type: number, format: double }

    AdminSubmissionDetailResponse:
      type: object
      properties:
        evaluationId: { type: string }
        evaluationStatus:
          type: string
          enum: [DRAFT, SUBMITTED, SCORING, COMPLETED, FLAGGED, INVALIDATED]
        submittedAt: { type: string, format: date-time, nullable: true }
        totalScore: { type: number, format: double, nullable: true }
        campaignId: { type: string }
        campaignName: { type: string }
        campaignStatus:
          type: string
          enum: [DRAFT, SCHEDULED, ACTIVE, PUBLISHED_OPEN, CLOSED, RESULTS_PUBLISHED, ARCHIVED]
        assignmentId: { type: string }
        evaluatorId: { type: string }
        evaluateeId: { type: string }
        evaluatorRole: { type: string }
        stepType: { type: string, nullable: true }
        sectionId: { type: string, nullable: true }
        facultyId: { type: string, nullable: true }
        anonymityMode: { type: string, nullable: true }
        assignmentStatus: { type: string }

    CreateTemplateRequest:
      type: object
      required: [name]
      properties:
        name: { type: string }
        description: { type: string }
        category: { type: string }
        scoringMethod:
          type: string
          enum: [WEIGHTED_AVERAGE, SIMPLE_AVERAGE, MEDIAN, PERCENTILE_RANK, CUSTOM_FORMULA]
        sections:
          type: array
          items:
            $ref: '#/components/schemas/SectionRequest'
        customFormula: { type: string }

    CreateQuestionBankSetRequest:
      type: object
      required: [name]
      properties:
        tenantId: { type: string, nullable: true }
        name: { type: string }
        versionTag: { type: string, nullable: true }
        owner: { type: string, nullable: true }

    CreateQuestionBankItemRequest:
      type: object
      required: [stableKey, defaultType, defaultMarks]
      properties:
        stableKey: { type: string }
        contextType: { type: string, nullable: true }
        categoryName: { type: string, nullable: true }
        defaultType: { type: string }
        defaultMarks: { type: number, format: double }

    CreateQuestionBankItemVersionRequest:
      type: object
      required: [status, questionText, questionType, marks]
      properties:
        status: { type: string }
        changeSummary: { type: string, nullable: true }
        questionText: { type: string }
        questionType: { type: string }
        marks: { type: number, format: double }
        remarksMandatory: { type: boolean }
        metadata:
          $ref: '#/components/schemas/AnyObject'

    ScoringPreviewRequest:
      type: object
      required: [templateId, answers]
      properties:
        templateId: { type: string }
        scoringMethodOverride:
          type: string
          enum: [WEIGHTED_AVERAGE, SIMPLE_AVERAGE, MEDIAN, PERCENTILE_RANK, CUSTOM_FORMULA]
          nullable: true
        customFormulaOverride: { type: string, nullable: true }
        answers:
          type: array
          items:
            $ref: '#/components/schemas/AnswerRequest'

    UpdateTemplateRequest:
      type: object
      required: [name]
      properties:
        name: { type: string }
        description: { type: string }
        category: { type: string }
        scoringMethod:
          type: string
          enum: [WEIGHTED_AVERAGE, SIMPLE_AVERAGE, MEDIAN, PERCENTILE_RANK, CUSTOM_FORMULA]
        sections:
          type: array
          items:
            $ref: '#/components/schemas/SectionRequest'
        customFormula: { type: string }

    SectionRequest:
      type: object
      required: [title]
      properties:
        id: { type: string }
        title: { type: string }
        description: { type: string }
        orderIndex: { type: integer }
        weight: { type: number, format: double }
        questions:
          type: array
          items:
            $ref: '#/components/schemas/QuestionRequest'

    QuestionRequest:
      type: object
      required: [text, type]
      properties:
        id: { type: string }
        text: { type: string }
        type:
          type: string
          enum:
            - SINGLE_CHOICE
            - MULTIPLE_CHOICE
            - LIKERT_SCALE
            - OPEN_TEXT
            - NUMERIC_RATING
            - BOOLEAN
            - MATRIX
            - RANKING
            - NPS
            - FILE_UPLOAD
        orderIndex: { type: integer }
        required: { type: boolean }
        options:
          type: array
          items: { type: string }
        weight: { type: number, format: double }
        metadata:
          $ref: '#/components/schemas/AnyObject'
        conditionalLogic: { type: string }

    TemplateResponse:
      type: object
      properties:
        id: { type: string }
        name: { type: string }
        description: { type: string }
        category: { type: string }
        status:
          type: string
          enum: [DRAFT, PUBLISHED, DEPRECATED, ARCHIVED]
        currentVersion: { type: integer }
        scoringMethod:
          type: string
          enum: [WEIGHTED_AVERAGE, SIMPLE_AVERAGE, MEDIAN, PERCENTILE_RANK, CUSTOM_FORMULA]
        totalQuestions: { type: integer }
        sections:
          type: array
          items:
            $ref: '#/components/schemas/SectionResponse'
        createdBy: { type: string }
        createdAt: { type: string, format: date-time }
        updatedAt: { type: string, format: date-time }

    QuestionBankSetResponse:
      type: object
      properties:
        id: { type: integer, format: int64 }
        tenantId: { type: string, nullable: true }
        name: { type: string }
        versionTag: { type: string, nullable: true }
        owner: { type: string, nullable: true }
        status: { type: string }
        createdAt: { type: string, format: date-time }
        updatedAt: { type: string, format: date-time }

    QuestionBankItemResponse:
      type: object
      properties:
        id: { type: integer, format: int64 }
        setId: { type: integer, format: int64 }
        stableKey: { type: string }
        contextType: { type: string, nullable: true }
        categoryName: { type: string, nullable: true }
        defaultType: { type: string }
        defaultMarks: { type: number, format: double }
        activeVersionNo: { type: integer }
        status: { type: string }
        createdAt: { type: string, format: date-time }
        updatedAt: { type: string, format: date-time }

    QuestionBankItemVersionResponse:
      type: object
      properties:
        id: { type: integer, format: int64 }
        questionItemId: { type: integer, format: int64 }
        versionNo: { type: integer }
        status: { type: string }
        changeSummary: { type: string, nullable: true }
        questionText: { type: string }
        questionType: { type: string }
        marks: { type: number, format: double }
        remarksMandatory: { type: boolean }
        metadata:
          $ref: '#/components/schemas/AnyObject'
        effectiveFrom: { type: string, format: date-time, nullable: true }
        createdAt: { type: string, format: date-time }
        updatedAt: { type: string, format: date-time }

    QuestionVersionCompareResponse:
      type: object
      properties:
        questionItemId: { type: integer, format: int64 }
        fromVersion: { type: integer }
        toVersion: { type: integer }
        diffs:
          type: array
          items:
            $ref: '#/components/schemas/QuestionVersionDiff'

    QuestionVersionDiff:
      type: object
      properties:
        field: { type: string }
        fromValue: {}
        toValue: {}

    ScoringPreviewResponse:
      type: object
      properties:
        templateId: { type: string }
        scoringMethod:
          type: string
          enum: [WEIGHTED_AVERAGE, SIMPLE_AVERAGE, MEDIAN, PERCENTILE_RANK, CUSTOM_FORMULA]
        totalScore: { type: number, format: double }
        sections:
          type: array
          items:
            $ref: '#/components/schemas/ScoringPreviewSection'

    ScoringPreviewSection:
      type: object
      properties:
        sectionId: { type: string }
        sectionTitle: { type: string }
        score: { type: number, format: double }
        maxPossible: { type: number, format: double }
        answeredQuestions: { type: integer }
        totalQuestions: { type: integer }

    SectionResponse:
      type: object
      properties:
        id: { type: string }
        title: { type: string }
        description: { type: string }
        orderIndex: { type: integer }
        weight: { type: number, format: double }
        questions:
          type: array
          items:
            $ref: '#/components/schemas/QuestionResponse'

    QuestionResponse:
      type: object
      properties:
        id: { type: string }
        text: { type: string }
        type: { type: string }
        orderIndex: { type: integer }
        required: { type: boolean }
        options:
          type: array
          items: { type: string }
        weight: { type: number, format: double }
        metadata:
          $ref: '#/components/schemas/AnyObject'
        conditionalLogic: { type: string }

    IndividualReportResult:
      type: object
      properties:
        evaluateeId: { type: string }
        evaluateeName: { type: string }
        campaignId: { type: string }
        overallScore: { type: number, format: double }
        sectionScores:
          type: object
          additionalProperties:
            type: number
            format: double
        strengths:
          type: object
          additionalProperties:
            type: string
        weaknesses:
          type: object
          additionalProperties:
            type: string
        totalEvaluations: { type: integer }
        respondentCount: { type: integer }

    CampaignReportResult:
      type: object
      properties:
        campaignId: { type: string }
        campaignName: { type: string }
        averageScore: { type: number, format: double }
        completionPercentage: { type: number, format: double }
        totalAssignments: { type: integer }
        completedAssignments: { type: integer }
        sectionAverages:
          type: object
          additionalProperties:
            type: number
            format: double

    SettingResponse:
      type: object
      properties:
        key: { type: string }
        value: { type: string }
        category: { type: string }
        description: { type: string }
        updatedBy: { type: string }
        updatedAt: { type: string }

    OverrideResponse:
      type: object
      properties:
        campaignId: { type: string }
        key: { type: string }
        value: { type: string }
        updatedBy: { type: string }
        updatedAt: { type: string }

    IngestAudienceRequest:
      type: object
      required: [tenantId, sourceType]
      properties:
        tenantId: { type: string }
        sourceType:
          type: string
          enum: [CSV, JSON, REST, JDBC]
        sourceConfig:
          $ref: '#/components/schemas/AnyObject'
        mappingProfileId:
          type: integer
          format: int64
        dryRun:
          type: boolean

    ReplayAudienceIngestionRequest:
      type: object
      properties:
        dryRun:
          type: boolean
          nullable: true

    AudienceIngestionResponse:
      type: object
      properties:
        tenantId: { type: string }
        runId: { type: string }
        dryRun: { type: boolean }
        processedRecords: { type: integer }
        rejectedRecords: { type: integer }

    AudienceIngestionRunResponse:
      type: object
      properties:
        id: { type: string }
        tenantId: { type: string }
        sourceType: { type: string }
        status: { type: string }
        dryRun: { type: boolean }
        processedRecords: { type: integer }
        rejectedRecords: { type: integer }
        errorMessage: { type: string, nullable: true }
        startedAt: { type: string, format: date-time }
        endedAt: { type: string, format: date-time, nullable: true }

    AudienceIngestionRejectionResponse:
      type: object
      properties:
        id: { type: integer, format: int64 }
        runId: { type: string }
        tenantId: { type: string }
        rowNumber: { type: integer }
        reason: { type: string }
        rowData: { type: string }
        createdAt: { type: string, format: date-time }

    CreateAudienceMappingProfileRequest:
      type: object
      required: [tenantId, name, sourceType, fieldMappings]
      properties:
        tenantId: { type: string }
        name: { type: string }
        sourceType: { type: string }
        fieldMappings:
          type: object
          additionalProperties:
            type: string
        active:
          type: boolean
          nullable: true

    UpdateAudienceMappingProfileRequest:
      type: object
      required: [tenantId, name, fieldMappings]
      properties:
        tenantId: { type: string }
        name: { type: string }
        fieldMappings:
          type: object
          additionalProperties:
            type: string
        active:
          type: boolean
          nullable: true

    DeactivateAudienceMappingProfileRequest:
      type: object
      required: [tenantId]
      properties:
        tenantId: { type: string }

    ValidateAudienceMappingProfileRequest:
      type: object
      required: [sourceType, fieldMappings]
      properties:
        sourceType: { type: string }
        fieldMappings:
          type: object
          additionalProperties:
            type: string

    AudienceMappingProfileResponse:
      type: object
      properties:
        id: { type: integer, format: int64 }
        tenantId: { type: string }
        name: { type: string }
        sourceType: { type: string }
        fieldMappings:
          type: object
          additionalProperties:
            type: string
        active: { type: boolean }
        createdAt: { type: string, format: date-time }
        updatedAt: { type: string, format: date-time }

    AudienceMappingProfileEventResponse:
      type: object
      properties:
        id: { type: integer, format: int64 }
        profileId: { type: integer, format: int64 }
        tenantId: { type: string }
        eventType: { type: string }
        actor: { type: string }
        payload:
          $ref: '#/components/schemas/AnyObject'
        createdAt: { type: string, format: date-time }

    AudienceMappingValidationResponse:
      type: object
      properties:
        sourceType: { type: string }
        normalizedMappings:
          type: object
          additionalProperties:
            type: string
        valid: { type: boolean }

    CreateRuleDefinitionRequest:
      type: object
      required: [tenantId, name, semanticVersion, ruleType, ruleConfig]
      properties:
        tenantId: { type: string }
        name: { type: string }
        description: { type: string }
        semanticVersion:
          type: string
          pattern: '^\\d+\\.\\d+\\.\\d+$'
        ruleType:
          type: string
          enum: [ALL_TO_ALL, ROUND_ROBIN, MANAGER_HIERARCHY, ATTRIBUTE_MATCH]
        ruleConfig:
          $ref: '#/components/schemas/AnyObject'

    UpdateRuleDefinitionRequest:
      type: object
      required: [tenantId, name, semanticVersion, ruleType, ruleConfig]
      properties:
        tenantId: { type: string }
        name: { type: string }
        description: { type: string }
        semanticVersion:
          type: string
          pattern: '^\\d+\\.\\d+\\.\\d+$'
        ruleType:
          type: string
          enum: [ALL_TO_ALL, ROUND_ROBIN, MANAGER_HIERARCHY, ATTRIBUTE_MATCH]
        ruleConfig:
          $ref: '#/components/schemas/AnyObject'

    CreateRulePublishRequest:
      type: object
      required: [tenantId]
      properties:
        tenantId: { type: string }
        reasonCode: { type: string }
        comment: { type: string }

    DecideRulePublishRequest:
      type: object
      required: [tenantId]
      properties:
        tenantId: { type: string }
        decisionComment: { type: string }

    SimulateRuleRequest:
      type: object
      required: [tenantId, audienceSourceType, audienceSourceConfig]
      properties:
        tenantId: { type: string }
        audienceSourceType:
          type: string
          enum: [INLINE, DIRECTORY_SNAPSHOT]
        audienceSourceConfig:
          $ref: '#/components/schemas/AnyObject'
        diagnosticMode: { type: boolean }

    PublishRuleAssignmentsRequest:
      type: object
      required: [tenantId, campaignId, audienceSourceType, audienceSourceConfig]
      properties:
        tenantId: { type: string }
        campaignId: { type: string }
        audienceSourceType:
          type: string
          enum: [INLINE, DIRECTORY_SNAPSHOT]
        audienceSourceConfig:
          $ref: '#/components/schemas/AnyObject'
        replaceExistingAssignments: { type: boolean }
        dryRun: { type: boolean }

    RuleDefinitionResponse:
      type: object
      properties:
        id: { type: integer, format: int64 }
        tenantId: { type: string }
        name: { type: string }
        description: { type: string }
        semanticVersion: { type: string }
        status:
          type: string
          enum: [DRAFT, PUBLISHED, DEPRECATED]
        ruleType: { type: string }
        ruleConfig:
          $ref: '#/components/schemas/AnyObject'
        createdBy: { type: string }
        createdAt: { type: string, format: date-time }
        updatedAt: { type: string, format: date-time }
        publishedAt: { type: string, format: date-time, nullable: true }

    RulePublishRequestResponse:
      type: object
      properties:
        id: { type: integer, format: int64 }
        ruleDefinitionId: { type: integer, format: int64 }
        tenantId: { type: string }
        status:
          type: string
          enum: [PENDING, APPROVED, REJECTED]
        reasonCode: { type: string, nullable: true }
        comment: { type: string, nullable: true }
        requestedBy: { type: string }
        requestedAt: { type: string, format: date-time }
        decidedBy: { type: string, nullable: true }
        decidedAt: { type: string, format: date-time, nullable: true }
        decisionComment: { type: string, nullable: true }

    RuleSimulationResponse:
      type: object
      properties:
        ruleDefinitionId: { type: integer, format: int64 }
        ruleType: { type: string }
        generatedCount: { type: integer }
        generated:
          type: array
          items:
            $ref: '#/components/schemas/RuleSimulationMatch'
        excluded:
          type: array
          items:
            $ref: '#/components/schemas/RuleSimulationExclusion'

    RuleSimulationMatch:
      type: object
      properties:
        evaluatorId: { type: string }
        evaluateeId: { type: string }
        evaluatorRole: { type: string }
        reason: { type: string }
        metadata:
          $ref: '#/components/schemas/AnyObject'

    RuleSimulationExclusion:
      type: object
      properties:
        evaluatorId: { type: string }
        evaluateeId: { type: string }
        reason: { type: string }

    RuleControlPlaneCapabilitiesResponse:
      type: object
      properties:
        supportedRuleTypes:
          type: array
          items: { type: string }
        supportedAudienceSourceTypes:
          type: array
          items: { type: string }
        workflowConfig:
          $ref: '#/components/schemas/AnyObject'

    AssignmentReconciliationResponse:
      type: object
      properties:
        campaignId: { type: string }
        legacyCount: { type: integer }
        relationalCount: { type: integer }
        onlyInLegacyCount: { type: integer }
        onlyInRelationalCount: { type: integer }
        completionMismatchCount: { type: integer }
        consistent: { type: boolean }
        onlyInLegacy:
          type: array
          items: { type: string }
        onlyInRelational:
          type: array
          items: { type: string }
        completionMismatches:
          type: array
          items: { type: string }

    AssignmentParityReportResponse:
      type: object
      properties:
        scannedCampaigns: { type: integer }
        consistentCampaigns: { type: integer }
        inconsistentCampaigns: { type: integer }
        totalOnlyInLegacy: { type: integer }
        totalOnlyInRelational: { type: integer }
        totalCompletionMismatches: { type: integer }
        inconsistentCampaignIds:
          type: array
          items: { type: string }

    AssignmentBackfillResponse:
      type: object
      properties:
        scannedCampaigns: { type: integer }
        parsedAssignments: { type: integer }
        insertedAssignments: { type: integer }
        skippedExistingAssignments: { type: integer }
        invalidAssignments: { type: integer }
        dryRun: { type: boolean }

    DashboardStatsResponse:
      type: object
      properties:
        totalCampaigns: { type: integer, format: int64 }
        activeCampaigns: { type: integer, format: int64 }
        totalTemplates: { type: integer, format: int64 }
        activeEvaluations: { type: integer, format: int64 }
        completedEvaluations: { type: integer, format: int64 }
        completionRate: { type: number, format: double }
        recentActivity:
          type: array
          items:
            $ref: '#/components/schemas/DashboardActivityResponse'

    DashboardActivityResponse:
      type: object
      properties:
        title: { type: string }
        description: { type: string }
        timestamp: { type: string, format: date-time }
        type: { type: string }

    CreateNotificationRuleRequest:
      type: object
      required: [campaignId, ruleCode, triggerType, audience, channel]
      properties:
        campaignId: { type: string }
        ruleCode: { type: string }
        triggerType:
          type: string
          enum: [EVALUATION_SUBMITTED, CAMPAIGN_CLOSED, SCHEDULED]
        audience:
          type: string
          enum: [EVALUATOR, EVALUATEE, CAMPAIGN_OWNER, CUSTOM]
        channel:
          type: string
          enum: [IN_APP, EMAIL, WEBHOOK, SMS]
        scheduleExpr: { type: string, nullable: true }
        enabled: { type: boolean }
        config:
          $ref: '#/components/schemas/AnyObject'

    UpdateNotificationRuleRequest:
      type: object
      properties:
        triggerType:
          type: string
          enum: [EVALUATION_SUBMITTED, CAMPAIGN_CLOSED, SCHEDULED]
          nullable: true
        audience:
          type: string
          enum: [EVALUATOR, EVALUATEE, CAMPAIGN_OWNER, CUSTOM]
          nullable: true
        channel:
          type: string
          enum: [IN_APP, EMAIL, WEBHOOK, SMS]
          nullable: true
        scheduleExpr: { type: string, nullable: true }
        enabled: { type: boolean, nullable: true }
        config:
          $ref: '#/components/schemas/AnyObject'

    NotificationRuleResponse:
      type: object
      properties:
        id: { type: integer, format: int64 }
        campaignId: { type: string }
        ruleCode: { type: string }
        triggerType: { type: string }
        audience: { type: string }
        channel: { type: string }
        scheduleExpr: { type: string, nullable: true }
        enabled: { type: boolean }
        config:
          $ref: '#/components/schemas/AnyObject'
        createdAt: { type: string, format: date-time }
        updatedAt: { type: string, format: date-time }

    CreateNotificationTemplateRequest:
      type: object
      required: [templateCode, name, channel, body]
      properties:
        campaignId: { type: string, nullable: true }
        templateCode: { type: string }
        name: { type: string }
        channel:
          type: string
          enum: [IN_APP, EMAIL, WEBHOOK, SMS]
        subject: { type: string, nullable: true }
        body: { type: string }
        requiredVariables:
          type: array
          items: { type: string }
        status:
          type: string
          enum: [DRAFT, PUBLISHED, ARCHIVED]
          nullable: true

    UpdateNotificationTemplateRequest:
      type: object
      properties:
        name: { type: string, nullable: true }
        channel:
          type: string
          enum: [IN_APP, EMAIL, WEBHOOK, SMS]
          nullable: true
        subject: { type: string, nullable: true }
        body: { type: string, nullable: true }
        requiredVariables:
          type: array
          items: { type: string }
          nullable: true
        status:
          type: string
          enum: [DRAFT, PUBLISHED, ARCHIVED]
          nullable: true

    TestNotificationTemplateRequest:
      type: object
      required: [recipient]
      properties:
        recipient: { type: string }
        variables:
          $ref: '#/components/schemas/AnyObject'

    NotificationTemplateResponse:
      type: object
      properties:
        id: { type: integer, format: int64 }
        campaignId: { type: string, nullable: true }
        templateCode: { type: string }
        name: { type: string }
        channel: { type: string }
        subject: { type: string, nullable: true }
        body: { type: string }
        requiredVariables:
          type: array
          items: { type: string }
        status: { type: string }
        createdAt: { type: string, format: date-time }
        updatedAt: { type: string, format: date-time }

    NotificationDeliveryResponse:
      type: object
      properties:
        id: { type: integer, format: int64 }
        campaignId: { type: string, nullable: true }
        ruleId: { type: integer, format: int64, nullable: true }
        templateId: { type: integer, format: int64, nullable: true }
        recipient: { type: string }
        channel: { type: string }
        status: { type: string }
        errorCode: { type: string, nullable: true }
        errorMessage: { type: string, nullable: true }
        payload:
          $ref: '#/components/schemas/AnyObject'
        sentAt: { type: string, format: date-time, nullable: true }
        deliveredAt: { type: string, format: date-time, nullable: true }
        createdAt: { type: string, format: date-time }

    TemplateRenderResponse:
      type: object
      properties:
        recipient: { type: string }
        renderedBody: { type: string }
